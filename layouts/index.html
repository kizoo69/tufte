{{ define "main" }}
<article id="main" class="home-page">
{{ partial "brand.html" . }}
{{ with .Content }}
  <section>
  {{ . }}
  </section>
{{ end }}
<section class="posts">
{{/* Filter pages to only show those from sections WITHOUT type: book */}}
{{ $nonBookPages := slice }}
{{ range .Site.RegularPages }}
  {{ $isBookSection := false }}
  {{/* Check if page or its parent section has type: book */}}
  {{ if eq .Params.type "book" }}
    {{ $isBookSection = true }}
  {{ else if .CurrentSection }}
    {{ if eq .CurrentSection.Params.type "book" }}
      {{ $isBookSection = true }}
    {{ end }}
  {{ end }}
  {{ if not $isBookSection }}
    {{ $nonBookPages = $nonBookPages | append . }}
  {{ end }}
{{ end }}

{{/* Sort by date descending and paginate */}}
{{ $sorted := sort $nonBookPages "Date" "desc" }}
{{ $paginator := .Paginate $sorted }}

{{ range $paginator.Pages }}
  <h2>
  {{ if .IsNode }}
  <a href="{{ .Permalink }}">{{ .Title}}</a>
  {{ else }}
  <a href="{{ .RelPermalink }}">{{ .Title }}{{ if .Draft }}&nbsp;:: Draft{{end}}</a>
  {{ end }}
  </h2>

  {{ if .Description }}
  <p>{{ .Description }}</p>
  {{ else }}
  {{ if .Site.Params.showSummary }}
  <p>{{ truncate 140 .Summary }}</p>
  {{ end }}
  {{ end }}
{{ end }}
</section>

{{ if and (.Paginator) (gt .Paginator.TotalPages 1) }}
<hr />

<span class="previous-page">
{{ if .Paginator.HasPrev }}
<a class="link-reverse" href="{{.Paginator.Prev.URL}}">«</a>
{{ end }}
</span>

<span class="pagination-indicator">
{{.Paginator.PageNumber}} / {{.Paginator.TotalPages}}
</span>

<span class="next-page">
{{ if .Paginator.HasNext }}
<a class="link-reverse" href="{{.Paginator.Next.URL}}">»</a>
{{ end }}
</span>

{{ end }}

{{ partial "footer.html" . }}
</article>
{{ end }}
